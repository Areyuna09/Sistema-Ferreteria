<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.ferreteria.controllers.ReportsController" styleClass="dashboard-root">

    <!-- Navbar Superior -->
    <top>
        <fx:include fx:id="navbar" source="components/Navbar.fxml"/>
    </top>

    <!-- Contenido Principal -->
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
            <VBox styleClass="main-content" spacing="20" minHeight="600">
                <padding>
                    <Insets top="24" right="24" bottom="24" left="24"/>
                </padding>

                <!-- Header de Pagina -->
                <HBox alignment="CENTER_LEFT" spacing="16">
                    <VBox HBox.hgrow="ALWAYS" spacing="4">
                        <Label text="Reportes de Ventas" styleClass="page-title"/>
                        <Label text="Generación de reportes y análisis de datos" styleClass="page-subtitle"/>
                    </VBox>
                </HBox>

                <!-- Filtros de Reporte -->
                <VBox spacing="12" styleClass="info-section">
                    <Label text="Filtros de Reporte" styleClass="section-title"/>
                    <HBox alignment="CENTER_LEFT" spacing="12">
                        <ComboBox fx:id="rangeTypeCombo" prefWidth="150" promptText="Tipo de rango" styleClass="form-combo"/>
                        <DatePicker fx:id="startDatePicker" promptText="Fecha inicio" styleClass="form-field"/>
                        <DatePicker fx:id="endDatePicker" promptText="Fecha fin" styleClass="form-field"/>
                        <Button mnemonicParsing="false" onAction="#handleGenerateReport" styleClass="action-button primary" text="Generar Reporte" />
                    </HBox>
                </VBox>

                <!-- Búsqueda de Ventas -->
                <VBox spacing="12" styleClass="info-section">
                    <Label text="Búsqueda de Ventas" styleClass="section-title"/>
                    <HBox alignment="CENTER_LEFT" spacing="12">
                        <TextField fx:id="searchSaleIdField" prefWidth="100" promptText="ID Venta" styleClass="form-field"/>
                        <DatePicker fx:id="searchDatePicker" prefWidth="150" promptText="Fecha" styleClass="form-field"/>
                        <TextField fx:id="searchAmountField" prefWidth="120" promptText="Monto" styleClass="form-field"/>
                        <Button mnemonicParsing="false" onAction="#handleSearchSales" styleClass="action-button" text="Buscar" />
                        <Button mnemonicParsing="false" onAction="#handleClearSearchFilters" styleClass="action-button secondary" text="Limpiar" />
                    </HBox>
                </VBox>

                <!-- Botones de Exportación -->
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <Button fx:id="exportPdfBtn" mnemonicParsing="false" onAction="#handleExportPDF" styleClass="action-button" text="Exportar PDF" disable="true"/>
                    <Button fx:id="exportExcelBtn" mnemonicParsing="false" onAction="#handleExportExcel" styleClass="action-button" text="Exportar Excel" disable="true"/>
                </HBox>

                <!-- Estadísticas Generadas -->
                <HBox spacing="16" alignment="CENTER" fx:id="statsContainer" managed="false" visible="false">
                    <VBox styleClass="stat-card card-blue">
                        <Label text="TOTAL" styleClass="card-icon"/>
                        <Label fx:id="totalSalesLabel" text="$0.00" styleClass="card-value"/>
                        <Label text="Total Recaudado" styleClass="card-label"/>
                    </VBox>

                    <VBox styleClass="stat-card card-green">
                        <Label text="VENTAS" styleClass="card-icon"/>
                        <Label fx:id="totalTransactionsLabel" text="0" styleClass="card-value"/>
                        <Label text="Ventas Realizadas" styleClass="card-label"/>
                    </VBox>

                    <VBox styleClass="stat-card card-purple">
                        <Label text="PROMEDIO" styleClass="card-icon"/>
                        <Label fx:id="avgSaleLabel" text="$0.00" styleClass="card-value"/>
                        <Label text="Promedio por Venta" styleClass="card-label"/>
                    </VBox>

                    <VBox styleClass="stat-card card-orange">
                        <Label text="MAXIMO" styleClass="card-icon"/>
                        <Label fx:id="maxSaleLabel" text="$0.00" styleClass="card-value"/>
                        <Label text="Venta Máxima" styleClass="card-label"/>
                    </VBox>
                </HBox>

                <!-- Métodos de Pago -->
                <VBox spacing="12" fx:id="paymentMethodsSection" managed="false" visible="false">
                    <Label text="Totales por Método de Pago" styleClass="section-title"/>
                    <HBox spacing="16" fx:id="paymentMethodsContainer" minHeight="120"/>
                </VBox>

                <!-- Gráfico de Ventas -->
                <VBox spacing="12" fx:id="chartSection" managed="false" visible="false">
                    <Label text="Ventas por Día del Mes" styleClass="section-title"/>
                    <StackPane fx:id="chartContainer" styleClass="chart-container" prefHeight="250"/>
                </VBox>

                <!-- Productos Más Vendidos -->
                <VBox spacing="12" fx:id="productsSection" managed="false" visible="false">
                    <Label text="Productos Más Vendidos" styleClass="section-title"/>
                    <TableView fx:id="productsTable" prefHeight="200" styleClass="table-view">
                        <columns>
                           <TableColumn fx:id="productColumn" prefWidth="200" text="Producto" />
                           <TableColumn fx:id="variantColumn" prefWidth="150" text="Variante" />
                           <TableColumn fx:id="quantityColumn" prefWidth="80" text="Cantidad" />
                           <TableColumn fx:id="priceColumn" prefWidth="100" text="Precio" />
                           <TableColumn fx:id="totalColumn" prefWidth="100" text="Total" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>
                </VBox>

                <!-- Tabla de Búsqueda de Ventas -->
                <VBox spacing="12">
                    <Label text="Resultados de Búsqueda" styleClass="section-title"/>
                    <TableView fx:id="salesSearchTable" prefHeight="200" styleClass="table-view">
                        <columns>
                           <TableColumn fx:id="searchIdColumn" prefWidth="60" text="ID" />
                           <TableColumn fx:id="searchDateColumn" prefWidth="120" text="Fecha" />
                           <TableColumn fx:id="searchTotalColumn" prefWidth="100" text="Total" />
                           <TableColumn fx:id="searchStatusColumn" prefWidth="100" text="Estado" />
                           <TableColumn fx:id="searchSellerColumn" prefWidth="120" text="Vendedor" />
                           <TableColumn fx:id="searchActionsColumn" prefWidth="150" text="Acciones" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>
                </VBox>

                <!-- Estado Vacío -->
                <VBox fx:id="emptyStateContainer" alignment="CENTER" spacing="16" styleClass="empty-state">
                    <Label text="INFO" styleClass="empty-icon"/>
                    <Label text="No hay datos para mostrar" styleClass="empty-text"/>
                    <Label text="Genera un reporte para ver las estadísticas" styleClass="empty-subtext"/>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>
